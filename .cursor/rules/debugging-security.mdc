---
description: 调试方法论和安全编码实践
alwaysApply: true
---

# 调试与安全实践

## 调试方法论

### 根因分析优先

- 修复根因而非症状——不要用 `try/catch` 吞掉错误来"解决"问题
- 添加描述性的日志语句（使用项目的 `logger` 模块）来追踪变量状态和执行路径
- 隔离问题：编写小范围测试或添加临时断点来确认假设
- 如果多次尝试未解决问题，重新分析思路，换一种方法而非反复修改同一处

### 调试步骤

1. 复现问题——确认问题确实存在
2. 缩小范围——确定是哪个模块/函数引起的
3. 形成假设——基于日志和代码阅读提出可能原因
4. 验证假设——添加日志或编写测试验证
5. 修复并验证——修复后确保相关测试通过

## 安全编码

### 敏感信息保护

- **绝不**硬编码 API keys、密码、令牌等敏感信息到源代码中
- 所有密钥通过环境变量注入（参考 `CLAUDE.md` 中的环境变量列表）
- `.env` 文件不可提交到 git（确保在 `.gitignore` 中）
- 日志输出中屏蔽敏感字段（API key、密码等）

### 输入验证

- 所有用户输入必须验证和清洗后再使用
- API 请求参数验证失败返回 400 + 清晰的错误信息
- 文件路径操作防止路径遍历攻击（不信任用户提供的路径）
- SQL/NoSQL 查询使用参数化查询，禁止字符串拼接

### 认证与授权

- 遵循项目现有的 `authMiddleware` 认证模式
- 新增 API 端点默认需要认证，显式标注不需要认证的端点
- Scope 验证确保数据隔离——请求只能访问被授权的 scope

### 依赖安全

- 添加新依赖时优先选择维护活跃、下载量大的包
- 注意依赖的许可证兼容性
- 不引入存在已知安全漏洞的依赖版本

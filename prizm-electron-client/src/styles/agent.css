/* Agent page - 与 work-page 同框架：侧栏 + content 区，content 内 main 铺满并分区域滚动 */
.agent-page {
  display: flex;
  flex: 1;
  min-height: 0;
  height: 100%;
  overflow: hidden;
}
.agent-sidebar {
  width: 100%;
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.agent-sidebar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 12px;
  border-bottom: 1px solid var(--ant-color-border-secondary);
  flex-shrink: 0;
}
.agent-content {
  flex: 1;
  min-height: 0;
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Agent 右侧边栏 - 状态、上下文、文档、工具调用（宽度由 ResizableSidebar 控制） */
.agent-right-sidebar {
  width: 100%;
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.agent-right-sidebar-header {
  padding: 10px 12px;
  border-bottom: 1px solid var(--ant-color-border-secondary);
  flex-shrink: 0;
}
.agent-right-sidebar-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--ant-color-text-secondary);
}
.agent-right-sidebar-body {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}
.agent-right-section {
  flex-shrink: 0;
}
.agent-right-section-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--ant-color-text-secondary);
  margin: 0 0 8px 0;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
.agent-right-section-icon {
  flex-shrink: 0;
  opacity: 0.85;
}
.agent-status-row {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--ant-color-text);
}
.agent-status-icon {
  flex-shrink: 0;
}
.agent-status-icon.spinning {
  animation: spin 1s linear infinite;
}
.agent-status-icon.idle {
  color: var(--ant-color-success);
}
.agent-status-icon.error {
  color: var(--ant-color-error);
}
.agent-status-error {
  color: var(--ant-color-error);
  font-size: 12px;
  word-break: break-word;
}
.agent-memory-state {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 6px;
}
.agent-memory-tier {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
}
.agent-memory-tier-label {
  color: var(--ant-color-text-secondary);
}
.agent-memory-tier-count {
  font-weight: 500;
  color: var(--ant-color-text);
}
.agent-context-preview {
  max-height: 160px;
  overflow-y: auto;
  background: var(--ant-color-bg-container);
  border: 1px solid var(--ant-color-border-secondary);
  border-radius: var(--ant-border-radius);
  padding: 10px;
  margin-bottom: 6px;
}
.agent-context-preview.agent-context-clickable {
  cursor: pointer;
  transition: border-color 0.2s, background 0.2s;
}
.agent-context-preview.agent-context-clickable:hover {
  border-color: var(--ant-color-primary);
  background: var(--ant-color-fill-tertiary);
}
.agent-context-click-hint {
  display: block;
  font-size: 10px;
  color: var(--ant-color-primary);
  margin-top: 6px;
}
.agent-context-modal-text {
  margin: 0;
  font-size: 13px;
  line-height: 1.6;
  white-space: pre-wrap;
  word-break: break-word;
  font-family: ui-monospace, 'Cascadia Code', 'Consolas', monospace;
}
.agent-context-text {
  margin: 0;
  font-size: 11px;
  line-height: 1.5;
  color: var(--ant-color-text-secondary);
  white-space: pre-wrap;
  word-break: break-word;
}
.agent-documents-list {
  max-height: 200px;
  overflow-y: auto;
  margin-bottom: 6px;
}
/* agent-documents-ul / agent-document-item / agent-doc-icon / agent-document-title 已迁移至 LobeUI List */
.agent-document-status {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 10px;
  color: var(--ant-color-text-tertiary);
}
.agent-document-status svg {
  flex-shrink: 0;
}
.agent-document-desc {
  font-size: 10px;
  color: var(--ant-color-text-tertiary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.agent-right-refresh {
  font-size: 11px;
  color: var(--ant-color-primary);
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
}
.agent-right-refresh:hover {
  text-decoration: underline;
}
.agent-right-refresh:disabled {
  color: var(--ant-color-text-tertiary);
  cursor: not-allowed;
}
/* agent-right-loading / agent-right-empty — 已迁移到 LoadingPlaceholder / EmptyState 组件 */
.agent-right-hint {
  font-size: 11px;
  font-style: italic;
}
/* 总览模式统计卡片 */
.agent-overview-stats {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.agent-overview-stat-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 10px;
  background: var(--ant-color-fill-quaternary);
  border-radius: var(--ant-border-radius);
  font-size: 12px;
}
.agent-overview-stat-label {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: var(--ant-color-text-secondary);
}
.agent-overview-stat-value {
  font-weight: 500;
  font-variant-numeric: tabular-nums;
  color: var(--ant-color-text);
}
/* agent-documents-compact / agent-document-item-compact 已迁移至 LobeUI List */
.agent-lock-session-link {
  font-size: 10px;
  font-family: ui-monospace, 'SFMono-Regular', Consolas, monospace;
  color: var(--ant-color-primary);
  cursor: pointer;
  white-space: nowrap;
  flex-shrink: 0;
  margin-left: auto;
}
.agent-lock-session-link:hover {
  text-decoration: underline;
}

/* 会话活动（合并区块） */
.agent-session-activity {
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-height: 300px;
  overflow-y: auto;
}
.agent-activity-group {
  font-size: 11px;
}
.agent-activity-group-label {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-weight: 600;
  color: var(--ant-color-text-secondary);
  margin-bottom: 4px;
}
.agent-activity-summary {
  margin: 0;
  font-size: 11px;
  color: var(--ant-color-text-secondary);
  padding: 4px 8px;
  background: var(--ant-color-fill-quaternary);
  border-radius: var(--ant-border-radius);
}
.agent-activity-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.agent-activity-item {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  margin-bottom: 3px;
  border-radius: var(--ant-border-radius);
  background: var(--ant-color-fill-quaternary);
  font-size: 11px;
}
.agent-activity-item:last-child {
  margin-bottom: 0;
}
.agent-activity-item.error {
  background: var(--ant-color-error-bg, #fff2f0);
}
.agent-activity-item-clickable {
  cursor: pointer;
  transition: background-color 0.15s;
}
.agent-activity-item-clickable:hover {
  background: var(--ant-color-primary-bg);
  color: var(--ant-color-primary);
}
.agent-activity-tool-name {
  font-weight: 500;
  color: var(--ant-color-text);
}
.agent-activity-badge {
  font-size: 9px;
  padding: 0 4px;
  border-radius: 3px;
  font-weight: 600;
}
.agent-activity-badge.error {
  color: var(--ant-color-error);
  background: var(--ant-color-error-bg, #fff2f0);
}
.agent-activity-action-icon {
  flex-shrink: 0;
  color: var(--ant-color-text-tertiary);
}
.agent-activity-action-label {
  color: var(--ant-color-text-secondary);
  font-weight: 500;
  min-width: 24px;
}
.agent-activity-kind {
  font-size: 9px;
  color: var(--ant-color-text-tertiary);
}
.agent-activity-title {
  color: var(--ant-color-text-secondary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 120px;
}

/* 会话统计（token + 记忆） */
.agent-session-stats {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.agent-stats-group {
  font-size: 12px;
}
.agent-stats-group-label {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-weight: 500;
  color: var(--ant-color-text-secondary);
  margin-bottom: 6px;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.02em;
}
.agent-stats-rows {
  display: flex;
  flex-direction: column;
  gap: 3px;
}
.agent-stats-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 3px 8px;
  border-radius: 4px;
  background: var(--ant-color-fill-quaternary);
  font-size: 12px;
}
.agent-stats-row-sub {
  padding-left: 16px;
  background: none;
  font-size: 11px;
}
.agent-stats-row-memory .agent-stats-key {
  color: var(--ant-color-primary);
}
.agent-stats-row-highlight {
  margin-top: 2px;
  padding: 4px 8px;
  border-radius: 6px;
  background: var(--ant-color-primary-bg);
  border: 1px solid var(--ant-color-primary-border);
  font-size: 12px;
}
.agent-stats-row-highlight .agent-stats-key {
  color: var(--ant-color-primary);
  font-weight: 600;
}
.agent-stats-row-highlight .agent-stats-value {
  color: var(--ant-color-primary);
  font-weight: 600;
}
.agent-stats-key {
  color: var(--ant-color-text-secondary);
}
.agent-stats-value {
  font-variant-numeric: tabular-nums;
  color: var(--ant-color-text);
  font-weight: 500;
}
.agent-stats-value-secondary {
  font-weight: 400;
  color: var(--ant-color-text-tertiary);
}
.agent-stats-memory-list {
  list-style: none;
  padding: 0;
  margin: 6px 0 0 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
  max-height: 200px;
  overflow-y: auto;
}
.agent-stats-memory-item {
  display: flex;
  gap: 6px;
  align-items: flex-start;
  font-size: 11px;
  line-height: 1.4;
  padding: 4px 6px;
  border-radius: 4px;
  background: var(--ant-color-fill-quaternary);
}
.agent-stats-memory-type {
  flex-shrink: 0;
  padding: 0 4px;
  border-radius: 3px;
  background: var(--ant-color-primary-bg);
  color: var(--ant-color-primary);
  font-size: 10px;
  font-weight: 500;
  line-height: 18px;
  white-space: nowrap;
}
.agent-stats-memory-text {
  color: var(--ant-color-text-secondary);
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
}

.agent-sidebar-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--ant-color-text-secondary);
}
/* 总览标签 */
.agent-overview-tab {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  margin: 4px 8px 2px;
  border-radius: var(--ant-border-radius);
  font-size: 13px;
  font-weight: 500;
  color: var(--ant-color-text-secondary);
  cursor: pointer;
  transition: background 0.2s, color 0.2s;
  user-select: none;
  border: 1px solid transparent;
}
.agent-overview-tab:hover {
  background: var(--ant-color-fill-tertiary);
  color: var(--ant-color-text);
}
.agent-overview-tab.active {
  background: var(--ant-color-primary-bg);
  color: var(--ant-color-primary);
  border-color: var(--ant-color-primary-border);
}

.agent-sessions-list {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}
.agent-sessions-loading,
.agent-sessions-empty {
  padding: 16px;
  font-size: 13px;
  color: var(--ant-color-text-secondary);
  text-align: center;
}
/* ── 文件树面板样式 ── */
.agent-sidebar .react-arborist {
  font-size: 12px;
}
.agent-sidebar .react-arborist [role='treeitem'] {
  outline: none;
}

.agent-main {
  flex: 1;
  min-height: 0;
  height: 100%;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  background: transparent;
}
.agent-messages {
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* 会话类型 Header：仅 BG / 工具会话显示，粘在顶部，顶边贴齐无镂空；含引用信息与「查看工作流」链接 */
.session-type-header {
  position: sticky;
  top: 0;
  z-index: 2;
  flex-shrink: 0;
  margin: -16px -16px 12px -16px;
  padding: 12px 16px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.02em;
  border-radius: 0;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}
.session-type-header__main {
  display: flex;
  align-items: center;
  gap: 8px;
}
.session-type-header--background {
  background: var(--ant-color-primary-bg-hover, var(--ant-color-primary-bg));
  color: var(--ant-color-primary);
  border-bottom: 1px solid var(--ant-color-primary-border);
}
.session-type-header--tool {
  background: var(--ant-color-warning-bg-hover, var(--ant-color-warning-bg));
  color: var(--ant-color-warning);
  border-bottom: 1px solid var(--ant-color-warning-border);
}
.session-type-header__label {
  text-transform: uppercase;
  opacity: 0.95;
}
.session-type-header__sub {
  font-weight: 700;
  opacity: 1;
}
.session-type-header__refs {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 12px 16px;
  font-size: 12px;
  font-weight: 500;
  opacity: 0.92;
}
.session-type-header__ref-item {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}
.session-type-header__ref-key {
  color: var(--ant-color-text-tertiary);
  font-weight: 600;
}
.session-type-header__ref-key::after {
  content: '：';
}
.session-type-header__ref-value {
  font-weight: 500;
}
.session-type-header__ref-code {
  font-family: var(--ant-font-mono);
  font-size: 11px;
  padding: 0 4px;
  border-radius: 4px;
  background: var(--ant-color-fill-quaternary);
}
.session-type-header__link {
  margin-left: 4px;
  padding: 0 4px !important;
  height: auto !important;
  font-size: 12px !important;
  font-weight: 600 !important;
}
.session-type-header__link:hover {
  text-decoration: underline;
}

.agent-message {
  display: flex;
  flex-direction: column;
  gap: 4px;
  max-width: 80%;
}
.agent-message-user {
  align-self: flex-end;
}
.agent-message-assistant {
  align-self: flex-start;
}
.agent-message-role {
  font-size: 12px;
  font-weight: 500;
  color: var(--ant-color-text-secondary);
}
.agent-message-content {
  padding: 10px 14px;
  border-radius: var(--ant-border-radius-lg);
  font-size: 14px;
  line-height: 1.6;
}
.agent-message-user .agent-message-content {
  background: var(--ant-color-primary);
  color: var(--ant-color-text-light-solid);
}
.agent-message-assistant .agent-message-content {
  background: var(--ant-color-bg-layout);
  border: 1px solid var(--ant-color-border);
}
.agent-message-streaming .agent-message-content {
  position: relative;
  animation: streaming-pulse 2s ease-in-out infinite;
}
@keyframes streaming-pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.85;
  }
}
.streaming-indicator {
  color: var(--ant-color-primary);
  font-size: 11px;
  font-weight: 500;
  animation: streaming-fade 1.5s ease-in-out infinite;
}
@keyframes streaming-fade {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}
/* 记忆来源高亮：滚动到目标消息后闪烁 */
.agent-message-highlight {
  animation: message-highlight-flash 3s ease-out;
  border-radius: var(--ant-border-radius-lg);
}
@keyframes message-highlight-flash {
  0% {
    background: var(--ant-color-primary-bg);
    box-shadow: 0 0 0 2px var(--ant-color-primary-border);
  }
  30% {
    background: var(--ant-color-primary-bg);
    box-shadow: 0 0 0 2px var(--ant-color-primary-border);
  }
  100% {
    background: transparent;
    box-shadow: none;
  }
}

/* ChatInputArea 容器：底部固定，限制高度不占满窗口 */
.agent-input-hint {
  margin: 0 0 6px 0;
  font-size: 12px;
  color: var(--ant-color-text-tertiary);
}
.agent-input-hint code {
  padding: 0 4px;
  border-radius: 4px;
  background: var(--ant-color-fill-quaternary);
  font-size: 11px;
}

/* 输入框占位提示（@ / 命令等） */
.chat-input-placeholder {
  font-size: 13px;
  color: var(--ant-color-text-tertiary);
}
.chat-input-placeholder code {
  padding: 0 4px;
  border-radius: 4px;
  background: var(--ant-color-fill-quaternary);
  font-size: 12px;
  font-weight: 500;
}
.chat-input-placeholder-sep {
  color: var(--ant-color-text-quaternary);
  user-select: none;
}

/* ═══ @ / 提示候选框 ═══ */

.mention-slash-overlay {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 100%;
  z-index: 100;
  margin-bottom: 4px;
  max-height: 320px;
  overflow: auto;
  background: var(--ant-color-bg-elevated, var(--colorBgContainer, #fff));
  border-radius: 10px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.06);
  border: 1px solid var(--ant-color-border, var(--colorBorder, #d9d9d9));
  padding: 4px;
  overscroll-behavior: contain;
}

.mention-slash-overlay .lobe-list-item {
  padding: 8px 12px;
  border-radius: 6px;
}

.mention-slash-desc {
  font-size: 12px;
  color: var(--ant-color-text-tertiary);
  font-weight: normal;
}

/* 面包屑（/arg 二级模式头部） */
.mention-overlay-breadcrumb {
  padding: 5px 10px;
  font-size: 11px;
  color: var(--ant-color-text-tertiary);
  border-bottom: 1px solid var(--ant-color-border-secondary, rgba(0, 0, 0, 0.04));
  margin-bottom: 2px;
  letter-spacing: 0.02em;
}

/* 分组头 */
.mention-overlay-group-header {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 6px 10px 3px;
  font-size: 11px;
  font-weight: 600;
  color: var(--ant-color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.04em;
  user-select: none;
}
.mention-overlay-group-header:not(:first-child) {
  margin-top: 4px;
  border-top: 1px solid var(--ant-color-border-secondary, rgba(0, 0, 0, 0.04));
  padding-top: 8px;
}
.mention-overlay-group-count {
  font-size: 10px;
  font-weight: 500;
  color: var(--ant-color-text-quaternary);
  margin-left: auto;
}

/* 单条引用候选 */
.mention-overlay-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 150ms ease, transform 100ms ease;
}
.mention-overlay-item:hover {
  background: var(--ant-color-fill-tertiary, rgba(0, 0, 0, 0.04));
}
.mention-overlay-item--active {
  background: color-mix(in srgb, var(--ant-color-primary, #1677ff) 10%, transparent) !important;
}
.mention-overlay-item__icon {
  flex-shrink: 0;
  opacity: 0.8;
}
.mention-overlay-item__body {
  display: flex;
  flex-direction: column;
  gap: 1px;
  min-width: 0;
  flex: 1;
}
.mention-overlay-item__title {
  font-size: 13px;
  font-weight: 500;
  line-height: 1.4;
  color: var(--ant-color-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.mention-overlay-item--active .mention-overlay-item__title {
  color: var(--ant-color-primary, #1677ff);
}
.mention-overlay-item__meta {
  font-size: 11px;
  line-height: 1.3;
  color: var(--ant-color-text-tertiary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  gap: 6px;
}
.mention-overlay-item__status {
  display: inline-flex;
  align-items: center;
  padding: 0 4px;
  font-size: 10px;
  line-height: 16px;
  border-radius: 3px;
  background: var(--ant-color-fill-quaternary, rgba(0, 0, 0, 0.02));
  color: var(--ant-color-text-secondary);
}

/* 滚动条美化 */
.mention-slash-overlay::-webkit-scrollbar {
  width: 4px;
}
.mention-slash-overlay::-webkit-scrollbar-track {
  background: transparent;
}
.mention-slash-overlay::-webkit-scrollbar-thumb {
  background: var(--ant-color-fill-tertiary, rgba(0, 0, 0, 0.06));
  border-radius: 2px;
}
.mention-slash-overlay::-webkit-scrollbar-thumb:hover {
  background: var(--ant-color-fill-secondary, rgba(0, 0, 0, 0.1));
}

/* Overlay entrance animation */
@keyframes mention-overlay-enter {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.mention-slash-overlay {
  animation: mention-overlay-enter 150ms ease-out;
}

/* ═══ 引用标签（RefChips）═══ */

.ref-chip {
  animation: ref-chip-enter 200ms ease-out;
}
@keyframes ref-chip-enter {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.ref-chip:hover {
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
}
.ref-chip__close:focus-visible {
  outline: 2px solid var(--ant-color-primary, #1677ff);
  outline-offset: 1px;
}

/* ═══ 内联资源引用 chip（Markdown 中的 @(type:id)） ═══ */

.prizm-ref-chip {
  display: inline-flex;
  align-items: center;
  gap: 3px;
  padding: 1px 6px;
  border-radius: 4px;
  font-size: 0.85em;
  font-weight: 500;
  font-family: inherit;
  line-height: 1.5;
  white-space: nowrap;
  vertical-align: baseline;
  cursor: default;
  transition: opacity 150ms ease;
}
.prizm-ref-chip:hover {
  opacity: 0.85;
}
.prizm-ref-chip__tag {
  font-size: 0.8em;
  font-weight: 600;
  opacity: 0.7;
  margin-right: 1px;
}

/* 富文本块输入：命令/引用 chip + contenteditable */
.block-input-editor:empty::before,
.block-input-editor[data-empty='true']::before {
  content: attr(data-placeholder);
  color: var(--ant-color-text-tertiary);
}
.block-input-editor .chat-input-chip {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  padding: 0 6px;
  border-radius: 4px;
  font-size: 0.85em;
  font-weight: 500;
  line-height: 1.6;
  white-space: nowrap;
  vertical-align: baseline;
  cursor: default;
  user-select: none;
  transition: opacity 150ms ease;
}
.block-input-editor .chat-input-chip:hover {
  opacity: 0.8;
}
.block-input-editor .chat-input-chip__tag {
  font-size: 0.8em;
  font-weight: 600;
  opacity: 0.7;
  margin-right: 1px;
}

.agent-input-wrap {
  width: 100%;
  border-top: 1px solid var(--ant-color-border-secondary);
  background: var(--ant-color-bg-layout);
  flex-shrink: 0;
  max-height: 360px;
}
.agent-input-wrap [contenteditable='true'] {
  caret-color: var(--ant-color-primary, #1677ff);
  outline: none;
}
/* 悬浮面板样式：LobeHub 风格，圆角阴影由 ChatInput inputContainerProps 控制 */
.agent-input-floating {
  padding: 8px 16px 16px;
  border-top: none;
  background: transparent;
}
.agent-empty {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px;
  text-align: center;
  color: var(--ant-color-text-secondary);
}
.agent-empty-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--ant-color-text);
  margin-bottom: 8px;
}
.agent-empty-desc {
  font-size: 14px;
  margin-bottom: 16px;
}

/* Agent thinking indicator - LLM 生成工具参数时的「思考中」提示 */
.agent-thinking-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  margin: 4px 48px;
  font-size: 12px;
  color: var(--ant-color-text-tertiary, #999);
  animation: agent-thinking-fade 1.5s ease-in-out infinite;
}
.agent-thinking-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--ant-color-primary, #1677ff);
  animation: agent-thinking-pulse 1.2s ease-in-out infinite;
}
@keyframes agent-thinking-pulse {
  0%,
  100% {
    opacity: 0.3;
    transform: scale(0.8);
  }
  50% {
    opacity: 1;
    transform: scale(1.2);
  }
}
@keyframes agent-thinking-fade {
  0%,
  100% {
    opacity: 0.5;
  }
  50% {
    opacity: 1;
  }
}

/* Agent error banner */
.agent-error-banner {
  padding: 8px 16px;
  background: var(--ant-color-error-bg, #fff2f0);
  border: 1px solid var(--ant-color-error-border, #ffccc7);
  border-radius: var(--ant-border-radius);
  color: var(--ant-color-error);
  font-size: 13px;
  margin: 0 16px;
  flex-shrink: 0;
}

/* 助手消息额外信息容器 */
.assistant-message-extra {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 8px;
}
/* 工具调用（对话内的折叠列表，旧消息回放时使用） */
.tool-calls-details {
  margin: 0;
  border: 1px solid var(--ant-color-border-secondary);
  border-radius: var(--ant-border-radius);
  background: var(--ant-color-fill-quaternary);
}
.tool-calls-summary {
  cursor: pointer;
  padding: 6px 10px;
  font-size: 12px;
  font-weight: 500;
  color: var(--ant-color-text-secondary);
  transition: color 0.15s ease;
}
.tool-calls-summary:hover {
  color: var(--ant-color-text);
}
.tool-calls-list {
  margin: 0;
  padding: 8px 12px;
  list-style: none;
  border-top: 1px solid var(--ant-color-border-secondary);
  max-height: 400px;
  overflow-y: auto;
}
.tool-call-item {
  padding: 6px 0;
  border-bottom: none;
  font-size: 11px;
}
.tool-call-item:last-child {
  border-bottom: none;
}

/* 助手消息按 parts 内联：文本段 + 工具卡片 */
.assistant-message-by-parts {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.assistant-part-text {
  line-height: 1.6;
}
.assistant-part-text .lobe-markdown {
  margin: 0;
}

/* ═══════ 工具卡片（新） ═══════ */
.tool-card {
  position: relative;
  border: 1px solid var(--ant-color-border-secondary);
  border-radius: 10px;
  overflow: hidden;
  background: var(--ant-color-bg-container);
  transition: border-color 0.2s, box-shadow 0.2s;
}
.tool-card:hover {
  border-color: var(--ant-color-border);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
}
.tool-card--error {
  border-color: var(--ant-color-error-border);
  background: color-mix(in srgb, var(--ant-color-error-bg) 40%, var(--ant-color-bg-container));
}
.tool-card--error:hover {
  border-color: var(--ant-color-error);
}

/* 左侧彩色指示条 */
.tool-card__indicator {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  border-radius: 3px 0 0 3px;
}

/* 分类小图标圆 */
.tool-card__icon-wrap {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 7px;
  background: var(--tc-accent, #94a3b8);
  flex-shrink: 0;
}
.tool-card__icon-wrap .anticon,
.tool-card__icon-wrap svg {
  color: #fff !important;
}

/* 工具名 */
.tool-card__name {
  font-weight: 600;
  font-size: 13px;
  line-height: 1.4;
  color: var(--ant-color-text);
}

/* 参数摘要 */
.tool-card__desc {
  font-size: 12px;
  color: var(--ant-color-text-description);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* preparing / running 的脉冲文字 */
.tool-card__status-text {
  font-size: 12px;
  color: var(--ant-color-text-quaternary);
  animation: tc-pulse 1.5s ease-in-out infinite;
}
@keyframes tc-pulse {
  0%,
  100% {
    opacity: 0.4;
  }
  50% {
    opacity: 1;
  }
}

/* 旋转加载图标 */
.tool-card__spinner {
  color: var(--ant-color-text-quaternary);
  animation: tc-spin 0.8s linear infinite;
  flex-shrink: 0;
}
@keyframes tc-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

/* 可点击的头部 */
.tool-card__header {
  cursor: pointer;
  padding: 10px 14px;
  user-select: none;
  transition: background 0.15s;
}
.tool-card__header:hover {
  background: var(--ant-color-fill-quaternary);
}

/* 展开箭头 */
.tool-card__chevron {
  color: var(--ant-color-text-quaternary);
  transition: transform 0.2s;
  flex-shrink: 0;
}
.tool-card__chevron--open {
  transform: rotate(180deg);
}

/* 「打开」按钮 */
.tool-card__open-btn {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 10px;
  border: 1px solid var(--ant-color-primary-border);
  border-radius: 6px;
  background: var(--ant-color-primary-bg);
  color: var(--ant-color-primary);
  font-size: 12px;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.15s;
  flex-shrink: 0;
  line-height: 1.6;
}
.tool-card__open-btn:hover {
  background: var(--ant-color-primary-bg-hover, var(--ant-color-primary-bg));
  border-color: var(--ant-color-primary);
  color: var(--ant-color-primary-hover, var(--ant-color-primary));
}
.tool-card__open-btn:active {
  transform: scale(0.97);
}

/* ── 等待用户交互卡片 ── */
.tool-card--interact {
  border-color: var(--ant-color-warning-border, #ffe58f);
  background: color-mix(
    in srgb,
    var(--ant-color-warning-bg, #fffbe6) 50%,
    var(--ant-color-bg-container)
  );
}
.tool-card--interact:hover {
  border-color: var(--ant-color-warning, #faad14);
}

.tool-card__interact-body {
  margin-top: 8px;
  padding: 8px 0 2px;
  border-top: 1px solid var(--ant-color-warning-border, #ffe58f);
}

.tool-card__interact-message {
  font-size: 12px;
  color: var(--ant-color-text-secondary);
  margin-bottom: 6px;
}

.tool-card__interact-paths {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-bottom: 4px;
}

.tool-card__interact-path {
  display: block;
  font-size: 11px;
  padding: 3px 8px;
  background: var(--ant-color-fill-quaternary);
  border-radius: 4px;
  color: var(--ant-color-text);
  word-break: break-all;
  font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
}

.tool-card__interact-btn {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
  border: 1px solid;
  cursor: pointer;
  transition: all 0.15s;
}
.tool-card__interact-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.tool-card__interact-btn--approve {
  background: var(--ant-color-success-bg, #f6ffed);
  border-color: var(--ant-color-success-border, #b7eb8f);
  color: var(--ant-color-success, #52c41a);
}
.tool-card__interact-btn--approve:hover:not(:disabled) {
  background: var(--ant-color-success-bg-hover, #d9f7be);
  border-color: var(--ant-color-success, #52c41a);
}

.tool-card__interact-btn--deny {
  background: var(--ant-color-bg-container);
  border-color: var(--ant-color-border);
  color: var(--ant-color-text-secondary);
}
.tool-card__interact-btn--deny:hover:not(:disabled) {
  border-color: var(--ant-color-error, #ff4d4f);
  color: var(--ant-color-error, #ff4d4f);
}

/* ── 等待用户交互时的脉冲动画 ── */
.tool-card--interact .tool-card__indicator {
  animation: interact-pulse 1.5s ease-in-out infinite;
}

@keyframes interact-pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.4;
  }
}

/* ── 全局交互占位条（标题栏与内容区之间，常占位） ── */
.global-interact-strip {
  flex-shrink: 0;
  background: var(--ant-color-bg-container);
  border-bottom: 1px solid var(--ant-color-border-secondary);
  transition: height 0.2s ease, min-height 0.2s ease;
}
.global-interact-strip__inner {
  padding: 0 16px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.global-interact-strip__toggle {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  min-height: 44px;
  padding: 8px 0;
  font-size: 13px;
  color: var(--ant-color-text);
  background: none;
  border: none;
  cursor: pointer;
  text-align: left;
  transition: background 0.15s, color 0.15s;
  border-radius: 6px;
  outline: none;
}
.global-interact-strip__toggle:hover {
  background: var(--ant-color-fill-quaternary);
  color: var(--ant-color-primary);
}
.global-interact-strip__toggle:focus-visible {
  box-shadow: 0 0 0 2px var(--ant-color-primary-border);
}
.global-interact-strip__toggle span {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.global-interact-strip__content {
  padding: 8px 0 12px;
  border-top: 1px solid var(--ant-color-border-secondary);
  margin-top: 4px;
}
.global-interact-strip__source {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 10px;
  font-size: 12px;
}
.global-interact-strip__source-label {
  color: var(--ant-color-text-tertiary);
  flex-shrink: 0;
}
.global-interact-strip__source-value {
  color: var(--ant-color-text-secondary);
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 240px;
}
.global-interact-strip__view-source {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  min-height: 44px;
  padding: 6px 12px;
  font-size: 12px;
  color: var(--ant-color-primary);
  background: var(--ant-color-primary-bg);
  border: 1px solid var(--ant-color-primary-border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s;
  flex-shrink: 0;
}
.global-interact-strip__view-source:hover {
  background: var(--ant-color-primary-bg-hover, var(--ant-color-primary-bg));
  border-color: var(--ant-color-primary);
  color: var(--ant-color-primary-hover, var(--ant-color-primary));
}
.global-interact-strip__view-source:focus-visible {
  box-shadow: 0 0 0 2px var(--ant-color-primary-border);
}

/* ── 底部交互授权面板（固定在消息区底部） ── */
.interact-panel {
  background: color-mix(
    in srgb,
    var(--ant-color-warning-bg, #fffbe6) 60%,
    var(--ant-color-bg-container)
  );
  border: 1px solid var(--ant-color-warning-border, #ffe58f);
  border-radius: 12px;
  padding: 14px 16px;
  animation: interact-panel-enter 0.3s ease-out;
}
@keyframes interact-panel-enter {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.interact-panel__header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}
.interact-panel__icon {
  color: var(--ant-color-warning, #faad14);
  flex-shrink: 0;
}
.interact-panel__title {
  font-size: 13px;
  color: var(--ant-color-text);
}
.interact-panel__title strong {
  font-weight: 600;
}
.interact-panel__desc {
  font-size: 12px;
  color: var(--ant-color-text-secondary);
  margin-bottom: 8px;
}
.interact-panel__paths {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-bottom: 4px;
}
.interact-panel__path-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--ant-color-text-secondary);
}
.interact-panel__path-item code {
  display: inline-block;
  font-size: 11px;
  padding: 2px 8px;
  background: var(--ant-color-fill-quaternary);
  border-radius: 4px;
  color: var(--ant-color-text);
  word-break: break-all;
  font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
}
.interact-panel__btn {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 6px 16px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 500;
  border: 1px solid;
  cursor: pointer;
  transition: all 0.15s;
}
.interact-panel__btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
.interact-panel__btn--approve {
  background: var(--ant-color-success, #52c41a);
  border-color: var(--ant-color-success, #52c41a);
  color: #fff;
}
.interact-panel__btn--approve:hover:not(:disabled) {
  background: var(--ant-color-success-hover, #73d13d);
  border-color: var(--ant-color-success-hover, #73d13d);
}
.interact-panel__btn--approve:active:not(:disabled) {
  transform: scale(0.97);
}
.interact-panel__btn--deny {
  background: var(--ant-color-bg-container);
  border-color: var(--ant-color-border);
  color: var(--ant-color-text-secondary);
}
.interact-panel__btn--deny:hover:not(:disabled) {
  border-color: var(--ant-color-error, #ff4d4f);
  color: var(--ant-color-error, #ff4d4f);
}
.interact-panel__btn--deny:active:not(:disabled) {
  transform: scale(0.97);
}
.interact-panel__btn--warn {
  background: var(--ant-color-warning, #faad14);
  border-color: var(--ant-color-warning, #faad14);
  color: #fff;
}
.interact-panel__btn--warn:hover:not(:disabled) {
  background: var(--ant-color-warning-hover, #ffc53d);
  border-color: var(--ant-color-warning-hover, #ffc53d);
}

/* ── 交互面板 — 终端命令变体 ── */
.interact-panel--terminal {
  background: color-mix(
    in srgb,
    var(--ant-color-info-bg, #e6f7ff) 60%,
    var(--ant-color-bg-container)
  );
  border-color: var(--ant-color-info-border, #91d5ff);
}
.interact-panel--terminal .interact-panel__icon {
  color: var(--ant-color-info, #1890ff);
}

/* ── 交互面板 — 危险操作变体 ── */
.interact-panel--destructive {
  background: color-mix(
    in srgb,
    var(--ant-color-error-bg, #fff2f0) 60%,
    var(--ant-color-bg-container)
  );
  border-color: var(--ant-color-error-border, #ffccc7);
}
.interact-panel--destructive .interact-panel__icon {
  color: var(--ant-color-error, #ff4d4f);
}

/* ── 交互面板 — 终端命令预览 ── */
.interact-panel__command {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: var(--ant-color-text-secondary);
  margin-bottom: 4px;
}
.interact-panel__command code {
  display: inline-block;
  font-size: 12px;
  padding: 4px 10px;
  background: var(--ant-color-fill-quaternary);
  border-radius: 6px;
  color: var(--ant-color-text);
  word-break: break-all;
  font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
}
.interact-panel__cwd {
  font-size: 11px;
  color: var(--ant-color-text-quaternary);
}

/* ── 交互面板 — 危险操作描述 ── */
.interact-panel__destructive {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: var(--ant-color-error, #ff4d4f);
  margin-bottom: 4px;
  padding: 6px 10px;
  background: var(--ant-color-error-bg, #fff2f0);
  border-radius: 6px;
}

/* ── 工具卡片交互 — 危险操作按钮变体 ── */
.tool-card__interact-btn--warn {
  background: var(--ant-color-warning, #faad14) !important;
  border-color: var(--ant-color-warning, #faad14) !important;
  color: #fff !important;
}
.tool-card__interact-btn--warn:hover:not(:disabled) {
  background: var(--ant-color-warning-hover, #ffc53d) !important;
  border-color: var(--ant-color-warning-hover, #ffc53d) !important;
}

/* 展开内容 */
.tool-card__body {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 0 14px 12px;
  border-top: 1px solid var(--ant-color-border-secondary);
  margin-top: 0;
  padding-top: 10px;
}
.tool-card__section-label {
  font-size: 11px;
  color: var(--ant-color-text-quaternary);
  margin-bottom: 4px;
  font-weight: 500;
}
.tool-card__pre {
  margin: 0;
  padding: 8px 10px;
  font-size: 12px;
  background: var(--ant-color-fill-quaternary);
  border-radius: 6px;
  overflow: auto;
  max-height: 200px;
  white-space: pre-wrap;
  word-break: break-word;
  line-height: 1.5;
}
.tool-card__pre--error {
  color: var(--ant-color-error);
  background: var(--ant-color-error-bg);
}
.tool-card__streaming-args {
  padding: 0 14px 8px;
}
.tool-card__pre--streaming {
  max-height: 120px;
  animation: tool-card-streaming-pulse 1.5s ease-in-out infinite;
}
@keyframes tool-card-streaming-pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

/* Agent 后台对话指示器：导航栏 Agent 按钮右上角脉冲圆点 */
.agent-bg-indicator {
  display: inline-block;
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: var(--ant-color-primary, #1677ff);
  margin-left: 4px;
  vertical-align: top;
  position: relative;
  top: -1px;
  animation: agent-bg-pulse 1.5s ease-in-out infinite;
}
@keyframes agent-bg-pulse {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.4;
    transform: scale(0.75);
  }
}

/* Agent 交互警告指示器：导航栏 Agent 按钮右上角橙色脉冲圆点 */
.agent-interact-indicator {
  display: inline-block;
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: var(--ant-color-warning, #faad14);
  margin-left: 4px;
  vertical-align: top;
  position: relative;
  top: -1px;
  animation: agent-interact-pulse 1s ease-in-out infinite;
}
@keyframes agent-interact-pulse {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.5;
    transform: scale(0.8);
  }
}

/* Agent 会话列表：需要用户交互的会话徽章（橙色小圆点） */
.agent-session-interact-badge {
  display: inline-block;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--ant-color-warning, #faad14);
  margin-right: 6px;
  vertical-align: middle;
  flex-shrink: 0;
  animation: agent-interact-pulse 1s ease-in-out infinite;
}

/* Agent 会话列表：正在对话中的呼吸灯徽章（蓝色小圆点 + 光晕） */
.agent-session-chatting-badge {
  display: inline-block;
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: var(--ant-color-primary, #1677ff);
  box-shadow: 0 0 6px 2px var(--ant-color-primary, #1677ff);
  flex-shrink: 0;
  animation: agent-chatting-glow 1.5s ease-in-out infinite;
}

@keyframes agent-chatting-glow {
  0%,
  100% {
    opacity: 1;
    box-shadow: 0 0 6px 2px var(--ant-color-primary, #1677ff);
    transform: scale(1);
  }
  50% {
    opacity: 0.6;
    box-shadow: 0 0 12px 4px var(--ant-color-primary, #1677ff);
    transform: scale(1.2);
  }
}

/* Agent 会话列表：正在对话的状态标签 */
.agent-session-chatting-tag {
  font-size: 10px;
  line-height: 1;
  padding: 1px 5px;
  border-radius: 3px;
  background: var(--ant-color-primary-bg, #e6f4ff);
  color: var(--ant-color-primary, #1677ff);
  flex-shrink: 0;
  font-weight: 500;
  animation: agent-chatting-tag-pulse 2s ease-in-out infinite;
}

@keyframes agent-chatting-tag-pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.6;
  }
}

/* ── 文件内嵌预览面板（Agent 页右侧，保留向后兼容） ── */
.file-preview-panel {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
  background: var(--ant-color-bg-container);
}
.file-preview-panel__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 12px;
  border-bottom: 1px solid var(--ant-color-border-secondary);
  flex-shrink: 0;
  gap: 8px;
}
.file-preview-panel__title {
  font-size: 13px;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0;
}
.file-preview-panel__body {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
}
.file-preview-panel__body .md-preview-wrap {
  font-size: 13px;
  line-height: 1.7;
}

/* ══════════════════════════════════════════════════════════════
   Agent 中央分割布局 — CodeViewer | Chat（类 IDE 体验）
   ══════════════════════════════════════════════════════════════ */

/* 分割模式：水平 flex，让 CodeViewer + Chat 并排 */
.agent-content--split {
  flex-direction: row;
}
/* Chat 区域：分割时占据剩余空间 */
.agent-chat-area {
  flex: 1;
  min-width: 0;
  min-height: 0;
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ── CodeViewerPanel（基于 CodeMirror 6 的只读文件查看器） ── */
.code-viewer-panel {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 0;
  background: var(--ant-color-bg-container);
}
.code-viewer-panel__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px;
  border-bottom: 1px solid var(--ant-color-border-secondary);
  flex-shrink: 0;
  gap: 8px;
  background: var(--ant-color-bg-layout);
}
.code-viewer-panel__title {
  font-size: 13px;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0;
  color: var(--ant-color-text);
}
.code-viewer-panel__body {
  flex: 1;
  min-height: 0;
  overflow: hidden;
}
/* CodeMirror 填充容器 */
.code-viewer-panel__body .cm-editor {
  height: 100%;
}
.code-viewer-panel__body .cm-scroller {
  overflow: auto;
}

/* 底栏 Ctrl+L 快捷键提示 */
.code-viewer-panel__hint {
  padding: 4px 12px;
  font-size: 11px;
  color: var(--ant-color-text-tertiary);
  background: var(--ant-color-bg-layout);
  border-top: 1px solid var(--ant-color-border-secondary);
  flex-shrink: 0;
  text-align: center;
}
.code-viewer-panel__hint kbd {
  display: inline-block;
  padding: 1px 5px;
  font-size: 10px;
  font-family: ui-monospace, 'SFMono-Regular', Consolas, monospace;
  background: var(--ant-color-fill-quaternary);
  border: 1px solid var(--ant-color-border-secondary);
  border-radius: 3px;
  margin-right: 4px;
  box-shadow: 0 1px 0 var(--ant-color-border-secondary);
}

/* ── 消息悬浮操作栏增强 ── */
.agent-messages div[role='menubar'] {
  background: var(--ant-color-bg-elevated);
  border: 1px solid var(--ant-color-border);
  border-radius: 8px;
  padding: 2px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.04);
  transition: opacity 150ms ease, box-shadow 150ms ease;
  gap: 1px;
}
.agent-messages div[role='menubar'] button {
  border-radius: 6px;
  transition: background 120ms ease, color 120ms ease;
}
.agent-messages div[role='menubar'] button:hover {
  background: var(--ant-color-fill-secondary);
  color: var(--ant-color-primary);
}

/* ── 用户消息内联编辑器 ── */
.user-message-editor {
  display: flex;
  flex-direction: column;
  gap: 8px;
  width: 100%;
}
.user-message-editor__textarea {
  width: 100%;
  min-height: 60px;
  max-height: 240px;
  padding: 10px 12px;
  font-size: 14px;
  line-height: 1.6;
  font-family: inherit;
  color: var(--ant-color-text);
  background: var(--ant-color-bg-container);
  border: 1px solid var(--ant-color-primary);
  border-radius: 8px;
  resize: none;
  overflow-y: auto;
  outline: none;
  box-shadow: 0 0 0 2px var(--ant-color-primary-bg);
  transition: border-color 0.2s, box-shadow 0.2s;
}
.user-message-editor__textarea:focus {
  border-color: var(--ant-color-primary);
  box-shadow: 0 0 0 2px var(--ant-color-primary-bg-hover);
}
.user-message-editor__actions {
  display: flex;
  align-items: center;
  gap: 4px;
  justify-content: flex-end;
}

/* ── Snippet 引用标签（紫色主题） ── */
:root {
  --prizm-snippet-color: #722ed1;
  --prizm-snippet-bg: #f9f0ff;
  --prizm-snippet-border: #d3adf7;
}
/* 暗色模式覆盖 */
html[data-theme='dark'],
.dark {
  --prizm-snippet-color: #b37feb;
  --prizm-snippet-bg: rgba(114, 46, 209, 0.15);
  --prizm-snippet-border: rgba(114, 46, 209, 0.35);
}

/* ═══════════════════════════════════════════════════════════
   工具卡片 — 精简模式 (tool-badge)
   ═══════════════════════════════════════════════════════════ */

.tool-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  height: 26px;
  padding: 0 10px;
  border-radius: 13px;
  border: 1px solid var(--ant-color-border-secondary);
  background: var(--ant-color-bg-container);
  font-size: 12px;
  color: var(--ant-color-text-secondary);
  cursor: pointer;
  user-select: none;
  transition: border-color 0.15s, background 0.15s, box-shadow 0.15s;
  white-space: nowrap;
  max-width: 260px;
}
.tool-badge:hover {
  border-color: var(--ant-color-border);
  background: var(--ant-color-fill-quaternary);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}
.tool-badge--error {
  border-color: var(--ant-color-error-border);
  color: var(--ant-color-error);
}
.tool-badge--error:hover {
  border-color: var(--ant-color-error);
}
.tool-badge__dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}
.tool-badge__icon {
  flex-shrink: 0;
  display: flex;
  align-items: center;
}
.tool-badge__name {
  font-weight: 500;
  overflow: hidden;
  text-overflow: ellipsis;
}
.tool-badge__tag {
  font-size: 10px;
  padding: 0 5px;
  border-radius: 3px;
  font-weight: 500;
  line-height: 16px;
  flex-shrink: 0;
}

/* ── 工具卡片精简模式 Popover 内容 ── */
.tool-badge-popover {
  max-width: 420px;
  max-height: 360px;
  overflow: auto;
}
.tool-badge-popover__section {
  margin-bottom: 8px;
}
.tool-badge-popover__label {
  font-size: 11px;
  color: var(--ant-color-text-quaternary);
  margin-bottom: 4px;
  font-weight: 500;
}
.tool-badge-popover__pre {
  margin: 0;
  padding: 6px 8px;
  font-size: 11px;
  background: var(--ant-color-fill-quaternary);
  border-radius: 4px;
  overflow: auto;
  max-height: 160px;
  white-space: pre-wrap;
  word-break: break-word;
  line-height: 1.5;
}
.tool-badge-popover__pre--error {
  color: var(--ant-color-error);
  background: var(--ant-color-error-bg);
}

/* ── ToolGroup 分组折叠 ── */
.tool-group {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.tool-group__header {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  height: 28px;
  padding: 0 10px;
  border-radius: 14px;
  background: var(--ant-color-fill-quaternary);
  font-size: 12px;
  color: var(--ant-color-text-secondary);
  cursor: pointer;
  user-select: none;
  transition: background 0.15s;
  align-self: flex-start;
}
.tool-group__header:hover {
  background: var(--ant-color-fill-tertiary);
}
.tool-group__chevron {
  transition: transform 0.2s;
  flex-shrink: 0;
  color: var(--ant-color-text-quaternary);
}
.tool-group__chevron--open {
  transform: rotate(180deg);
}
.tool-group__stats {
  font-size: 11px;
  color: var(--ant-color-text-quaternary);
}
.tool-group__stats--has-error {
  color: var(--ant-color-error);
}
.tool-group__badges {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  padding: 2px 0;
}

/* ── 工具执行进度条动画（preparing/running 状态） ── */
.tool-card__progress-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--ant-color-fill-quaternary);
  overflow: hidden;
  border-radius: 0 0 10px 10px;
}
.tool-card__progress-bar::after {
  content: '';
  position: absolute;
  left: -40%;
  width: 40%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    var(--tc-accent, var(--ant-color-primary)),
    transparent
  );
  animation: tc-progress 1.2s ease-in-out infinite;
}
@keyframes tc-progress {
  0% {
    left: -40%;
  }
  100% {
    left: 100%;
  }
}

/* ── 结果复制按钮 ── */
.tool-card__copy-btn {
  position: absolute;
  top: 4px;
  right: 4px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 4px;
  border: none;
  background: var(--ant-color-bg-container);
  color: var(--ant-color-text-tertiary);
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.15s, background 0.15s, color 0.15s;
}
.tool-card__pre-wrap {
  position: relative;
}
.tool-card__pre-wrap:hover .tool-card__copy-btn {
  opacity: 1;
}
.tool-card__copy-btn:hover {
  background: var(--ant-color-fill-secondary);
  color: var(--ant-color-text);
}

/* ── 结果截断 "查看更多" ── */
.tool-card__show-more {
  display: inline-block;
  font-size: 11px;
  color: var(--ant-color-primary);
  cursor: pointer;
  margin-top: 4px;
  padding: 2px 0;
}
.tool-card__show-more:hover {
  text-decoration: underline;
}

/* ── 错误卡片重试提示 ── */
.tool-card__retry-hint {
  font-size: 11px;
  color: var(--ant-color-text-quaternary);
  margin-top: 4px;
  font-style: italic;
}

/* ── 开发模式：每轮对话调试入口 ── */
.round-debug-trigger {
  font-size: 11px;
  color: var(--ant-color-text-tertiary);
  padding: 2px 6px;
  min-height: 24px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  margin-bottom: 4px;
  transition: color 0.2s;
}
.round-debug-trigger:hover {
  color: var(--ant-color-primary);
}
.round-debug-trigger:focus-visible {
  outline: 2px solid var(--ant-color-primary);
  outline-offset: 2px;
}

.round-debug-modal__section {
  margin-bottom: 16px;
}
.round-debug-modal__section:last-child {
  margin-bottom: 0;
}
.round-debug-modal__pre {
  font-size: 12px;
  font-family: var(--ant-font-mono);
  background: var(--ant-color-fill-quaternary);
  padding: 10px 12px;
  border-radius: 6px;
  margin: 0;
  white-space: pre-wrap;
  word-break: break-all;
}
.round-debug-modal__pre--scroll {
  max-height: 360px;
  overflow-y: auto;
}
.round-debug-modal__prompt-wrap {
  position: relative;
}
.round-debug-modal__loading {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 16px;
  color: var(--ant-color-text-tertiary);
  font-size: 12px;
}

/* ── SkillManagerPanel (Popover 内会话 Skill/MCP 管理) ── */

.skill-manager-panel {
  width: 420px;
  max-height: 560px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  background: var(--ant-color-bg-elevated);
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  border: 1px solid var(--ant-color-border-secondary);
}

.skill-manager-panel__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 14px;
  border-bottom: 1px solid var(--ant-color-border-secondary);
  flex-shrink: 0;
}

.skill-manager-panel__title-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.skill-manager-panel__title-icon {
  color: var(--ant-color-warning);
  flex-shrink: 0;
}

.skill-manager-panel__close {
  flex-shrink: 0;
}

.skill-manager-panel__close:focus-visible {
  outline: 2px solid var(--ant-color-primary);
  outline-offset: 2px;
}

.skill-manager-panel__hint,
.skill-manager-panel__intro {
  padding: 0 14px;
  font-size: 12px;
  line-height: 1.4;
}

.skill-manager-panel__hint {
  padding-top: 8px;
  padding-bottom: 4px;
}

.skill-manager-panel__intro {
  padding-bottom: 12px;
  color: var(--ant-color-text-tertiary);
}

.skill-manager-panel__loading {
  padding: 20px 14px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.skill-manager-panel__body {
  overflow-y: auto;
  padding: 0 14px 14px;
  flex: 1;
  min-height: 0;
}

.skill-manager-panel__section {
  margin-bottom: 14px;
}

.skill-manager-panel__section:last-child {
  margin-bottom: 0;
}

.skill-manager-panel__section-header {
  margin-bottom: 6px;
}

.skill-manager-panel__section-hint {
  display: block;
  font-size: 11px;
  margin-bottom: 8px;
  color: var(--ant-color-text-tertiary);
}

/* 统一列表容器（Skills / MCP 共用） */
.skill-manager-panel__list {
  max-height: 200px;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid var(--ant-color-border-secondary);
}

.skill-manager-panel__row-addon {
  display: inline-flex;
  align-items: center;
}

.skill-manager-panel__switch-label {
  font-size: 11px;
  color: var(--ant-color-text-tertiary);
  white-space: nowrap;
}

.skill-manager-panel__chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.skill-manager-panel__chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  border-radius: 8px;
  background: var(--ant-color-primary-bg);
  font-size: 12px;
  min-height: 32px;
  transition: background 0.2s;
}

@media (prefers-reduced-motion: reduce) {
  .skill-manager-panel__chip {
    transition: none;
  }
}

.skill-manager-panel__chip-icon {
  color: var(--ant-color-warning);
  flex-shrink: 0;
}

.skill-manager-panel__chip-label {
  font-weight: 500;
  color: var(--ant-color-text);
}

.skill-manager-panel__chip-tag {
  flex-shrink: 0;
}

.skill-manager-panel__chip-action {
  margin-left: 2px;
  flex-shrink: 0;
}

.skill-manager-panel__chip-action:focus-visible {
  outline: 2px solid var(--ant-color-primary);
  outline-offset: 2px;
}

.skill-manager-panel__skill-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.skill-manager-panel__skill-card {
  padding: 10px 12px;
  min-height: 44px;
  border-radius: 10px;
}

.skill-manager-panel__skill-card:focus-visible {
  outline: 2px solid var(--ant-color-primary);
  outline-offset: 2px;
}

.skill-manager-panel__skill-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 8px;
  background: var(--ant-color-fill-quaternary);
  color: var(--ant-color-text-secondary);
  flex-shrink: 0;
}

.skill-manager-panel__empty {
  padding: 16px 0;
}

.skill-manager-panel__save-btn {
  margin-top: 12px;
  width: 100%;
  min-height: 36px;
}

.skill-manager-panel__save-btn:focus-visible {
  outline: 2px solid var(--ant-color-primary);
  outline-offset: 2px;
}
